# 数据库设计

## 授权认证

### 用户表(sys_user)

```sql
CREATE TABLE `sys_user` (
	`id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '用户id，自增主键',
	`username` VARCHAR(50) NOT NULL COMMENT '用户名' COLLATE 'utf8mb4_0900_ai_ci',
	`nickname` VARCHAR(50) NOT NULL DEFAULT 'momo' COLLATE 'utf8mb4_0900_ai_ci',
	`avatar` VARCHAR(255) NULL DEFAULT NULL COMMENT '头像' COLLATE 'utf8mb4_0900_ai_ci',
	`password` VARCHAR(255) NOT NULL COMMENT '密码' COLLATE 'utf8mb4_0900_ai_ci',
	`email` VARCHAR(50) NULL DEFAULT NULL COMMENT '邮箱' COLLATE 'utf8mb4_0900_ai_ci',
	`phone` VARCHAR(20) NULL DEFAULT NULL COMMENT '手机号' COLLATE 'utf8mb4_0900_ai_ci',
	`github_openid` VARCHAR(50) NULL DEFAULT NULL COMMENT 'github' COLLATE 'utf8mb4_0900_ai_ci',
	`linuxdo_openid` VARCHAR(50) NULL DEFAULT NULL COMMENT 'linuxdo' COLLATE 'utf8mb4_0900_ai_ci',
	`wechat_openid` VARCHAR(50) NULL DEFAULT NULL COLLATE 'utf8mb4_0900_ai_ci',
	`point` INT UNSIGNED NOT NULL DEFAULT '0' COMMENT '积分',
	`login_fail_time` INT NOT NULL DEFAULT '0' COMMENT '登录失败次数',
	`create_time` DATETIME NOT NULL COMMENT '创建时间',
	`update_time` DATETIME NOT NULL COMMENT '更新时间',
	`last_login_time` DATETIME NULL DEFAULT NULL COMMENT '上次登录时间',
	`last_login_ip` VARCHAR(50) NULL DEFAULT NULL COMMENT '上次登录ip' COLLATE 'utf8mb4_0900_ai_ci',
	PRIMARY KEY (`id`) USING BTREE,
	UNIQUE INDEX `username` (`username`) USING BTREE,
	UNIQUE INDEX `email` (`email`) USING BTREE,
	UNIQUE INDEX `phone` (`phone`) USING BTREE,
	UNIQUE INDEX `github_openid` (`github_openid`) USING BTREE,
	UNIQUE INDEX `linuxdo_openid` (`linuxdo_openid`) USING BTREE
)
COMMENT='用户表'
COLLATE='utf8mb4_0900_ai_ci'
ENGINE=InnoDB
AUTO_INCREMENT=2
;
```

### 角色表(sys_role)

```sql
CREATE TABLE `sys_role` (
	`id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '角色id，自增主键',
	`role_name` VARCHAR(50) NOT NULL COMMENT '角色名称' COLLATE 'utf8mb4_0900_ai_ci',
	`role_code` VARCHAR(50) NOT NULL COMMENT '角色编码（例如：admin, user）' COLLATE 'utf8mb4_0900_ai_ci',
	`description` VARCHAR(255) NULL DEFAULT NULL COMMENT '角色描述' COLLATE 'utf8mb4_0900_ai_ci',
	`create_time` DATETIME NOT NULL COMMENT '创建时间',
	`update_time` DATETIME NOT NULL COMMENT '更新时间',
	PRIMARY KEY (`id`) USING BTREE,
	UNIQUE INDEX `role_code` (`role_code`) USING BTREE
)
COMMENT='角色表'
COLLATE='utf8mb4_0900_ai_ci'
ENGINE=InnoDB
AUTO_INCREMENT=3
;
```

### 权限表(sys_permission表)

```sql
CREATE TABLE `sys_permission` (
	`id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '权限id，自增主键',
	`permission_name` VARCHAR(100) NOT NULL COMMENT '权限名称' COLLATE 'utf8mb4_0900_ai_ci',
	`permission_code` VARCHAR(100) NOT NULL COMMENT '权限编码（如：user:add, menu:view）' COLLATE 'utf8mb4_0900_ai_ci',
	`url` VARCHAR(255) NULL DEFAULT NULL COMMENT '接口路径（用于后端权限控制）' COLLATE 'utf8mb4_0900_ai_ci',
	`method` VARCHAR(10) NULL DEFAULT NULL COMMENT 'HTTP方法（GET, POST, PUT, DELETE）' COLLATE 'utf8mb4_0900_ai_ci',
	`type` TINYINT(1) NOT NULL DEFAULT '1' COMMENT '权限类型（1=菜单, 2=按钮, 3=接口）',
	`parent_id` INT UNSIGNED NULL DEFAULT NULL COMMENT '父权限id（用于菜单树）',
	`description` VARCHAR(255) NULL DEFAULT NULL COMMENT '权限描述' COLLATE 'utf8mb4_0900_ai_ci',
	`create_time` DATETIME NOT NULL COMMENT '创建时间',
	`update_time` DATETIME NOT NULL COMMENT '更新时间',
	PRIMARY KEY (`id`) USING BTREE,
	UNIQUE INDEX `permission_code` (`permission_code`) USING BTREE
)
COMMENT='权限表'
COLLATE='utf8mb4_0900_ai_ci'
ENGINE=InnoDB
AUTO_INCREMENT=4
;
```

### 用户角色关联表(sys_user_role)

```sql
CREATE TABLE `sys_user_role` (
	`id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键',
	`user_id` INT UNSIGNED NOT NULL COMMENT '用户id',
	`role_id` INT UNSIGNED NOT NULL COMMENT '角色id',
	PRIMARY KEY (`id`) USING BTREE,
	UNIQUE INDEX `user_role_unique` (`user_id`, `role_id`) USING BTREE,
	INDEX `fk_user_role_role` (`role_id`) USING BTREE,
	CONSTRAINT `fk_user_role_role` FOREIGN KEY (`role_id`) REFERENCES `sys_role` (`id`) ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT `fk_user_role_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`) ON UPDATE CASCADE ON DELETE CASCADE
)
COMMENT='用户角色关联表'
COLLATE='utf8mb4_0900_ai_ci'
ENGINE=InnoDB
AUTO_INCREMENT=2
;
```

### 角色权限关联表(sys_role_permission)

```sql
CREATE TABLE `sys_role_permission` (
	`id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键',
	`role_id` INT UNSIGNED NOT NULL COMMENT '角色id',
	`permission_id` INT UNSIGNED NOT NULL COMMENT '权限id',
	PRIMARY KEY (`id`) USING BTREE,
	UNIQUE INDEX `role_permission_unique` (`role_id`, `permission_id`) USING BTREE,
	INDEX `fk_role_permission_permission` (`permission_id`) USING BTREE,
	CONSTRAINT `fk_role_permission_permission` FOREIGN KEY (`permission_id`) REFERENCES `sys_permission` (`id`) ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT `fk_role_permission_role` FOREIGN KEY (`role_id`) REFERENCES `sys_role` (`id`) ON UPDATE CASCADE ON DELETE CASCADE
)
COMMENT='角色权限关联表'
COLLATE='utf8mb4_0900_ai_ci'
ENGINE=InnoDB
AUTO_INCREMENT=5
;
```